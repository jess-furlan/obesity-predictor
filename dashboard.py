# -*- coding: utf-8 -*-
"""dashboard

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14yL6eMAQmfDtfqoCesrLkakmvfKdD-K5
"""

import streamlit as st
import pandas as pd
import plotly.express as px
import seaborn as sns
import matplotlib.pyplot as plt

# Estilo visual
st.set_page_config(page_title="Dashboard Obesidade", layout="wide")
st.markdown("""
    <style>
    .main { background-color: #f5f9ff; }
    h1, h2, h3 {
        color: #20639B;
    }
    .stDataFrame th {
        background-color: #B3D4FC;
        color: black;
    }
    .css-1aumxhk, .css-1v0mbdj {
        background-color: #ffffff;
    }
    </style>
""", unsafe_allow_html=True)

# Carregar dados
df = pd.read_csv("Obesity.csv")
df["BMI"] = df["Weight"] / (df["Height"] ** 2)
df["Age_Group"] = pd.cut(df["Age"], bins=[0, 18, 30, 45, 60, 100],
                         labels=["<18", "18-30", "30-45", "45-60", "60+"])

st.title("ðŸ©º Dashboard Interativo - Obesidade e HÃ¡bitos de SaÃºde")

# NavegaÃ§Ã£o e Filtros
aba = st.sidebar.radio("Navegar por:", ["ðŸ“ˆ VisÃ£o Geral", "ðŸ’¡ HÃ¡bitos e Riscos", "ðŸ©º RecomendaÃ§Ãµes e Perfis de Risco"])
st.sidebar.header("ðŸŽ›ï¸ Filtros")
genero = st.sidebar.multiselect("GÃªnero", options=df["Gender"].unique(), default=df["Gender"].unique())
faixa_etaria = st.sidebar.multiselect("Faixa EtÃ¡ria", options=df["Age_Group"].unique(), default=df["Age_Group"].unique())
df_filt = df[df["Gender"].isin(genero) & df["Age_Group"].isin(faixa_etaria)]

# ðŸ“ˆ VisÃ£o Geral
if aba == "ðŸ“ˆ VisÃ£o Geral":
    st.header("ðŸ“Š DistribuiÃ§Ã£o dos nÃ­veis de obesidade")
    fig1 = px.histogram(df_filt, x="Obesity", color="Gender", facet_col="Age_Group", barmode="group",
                        category_orders={"Age_Group": ["<18", "18-30", "30-45", "45-60", "60+"]})
    st.plotly_chart(fig1, use_container_width=True)
    st.info("ðŸ”Ž A faixa de 30-45 anos com histÃ³rico familiar positivo Ã© a que apresenta maior incidÃªncia de obesidade tipo II e III.")

# ðŸ’¡ HÃ¡bitos e Riscos
elif aba == "ðŸ’¡ HÃ¡bitos e Riscos":
    st.header("ðŸ’¡ HÃ¡bitos e Comportamentos Relacionados")

    st.subheader("âš–ï¸ Atividade fÃ­sica vs Uso de dispositivos")
    fig2 = px.scatter(df_filt, x="FAF", y="TUE", color="Obesity", symbol="Gender", size="BMI",
                      labels={"FAF": "Atividade FÃ­sica", "TUE": "Tempo com Dispositivos"})
    st.plotly_chart(fig2, use_container_width=True)
    st.warning("ðŸ“‰ Alta exposiÃ§Ã£o a telas e baixa atividade fÃ­sica elevam o risco de obesidade grave.")

    st.subheader("ðŸ§ª CorrelaÃ§Ã£o entre variÃ¡veis numÃ©ricas")
    corr = df_filt[["Age", "Height", "Weight", "BMI", "FAF", "TUE", "CH2O"]].corr()
    fig3, ax = plt.subplots(figsize=(8, 6))
    sns.heatmap(corr, annot=True, cmap="coolwarm", fmt=".2f", ax=ax)
    st.pyplot(fig3)
    st.success("âœ… O Ã­ndice de massa corporal (IMC) tem alta correlaÃ§Ã£o com peso e baixa com atividade fÃ­sica.")

# ðŸ©º RecomendaÃ§Ãµes e Perfis de Risco
elif aba == "ðŸ©º RecomendaÃ§Ãµes e Perfis de Risco":
    st.header("ðŸ©º Perfis de Risco com Base em HistÃ³rico Familiar")

    risco_hist = pd.crosstab(df["family_history"], df["Obesity"], normalize="index") * 100
    st.bar_chart(risco_hist.T)

    st.subheader("ðŸ“Š HÃ¡bitos Frequentes entre Obesos Graves")
    obesos = df[df["Obesity"].isin(["Obesity_Type_I", "Obesity_Type_II", "Obesity_Type_III"])]
    col1, col2 = st.columns(2)

    with col1:
        favc = obesos["FAVC"].value_counts(normalize=True) * 100
        caec = obesos["CAEC"].value_counts(normalize=True) * 100
        st.write("ðŸ”¸ Consumo de alimentos calÃ³ricos")
        st.dataframe(favc.rename("Percentual (%)"))
        st.write("ðŸ”¸ Lanches entre refeiÃ§Ãµes")
        st.dataframe(caec.rename("Percentual (%)"))

    with col2:
        transp = obesos["MTRANS"].value_counts(normalize=True) * 100
        smoke = obesos["SMOKE"].value_counts(normalize=True) * 100
        st.write("ðŸ”¸ Transporte mais utilizado")
        st.dataframe(transp.rename("Percentual (%)"))
        st.write("ðŸ”¸ Fuma?")
        st.dataframe(smoke.rename("Percentual (%)"))

    st.markdown("---")
    st.subheader("ðŸ“Œ RecomendaÃ§Ãµes ClÃ­nicas")
    st.markdown("""
    - ðŸ§¬ HistÃ³rico familiar positivo + maus hÃ¡bitos = **alto risco**.
    - ðŸŸ Reduzir consumo calÃ³rico e beliscos fora de hora.
    - ðŸš¶ Incentivar transporte ativo e atividade fÃ­sica leve.
    - ðŸ’§ Monitorar ingestÃ£o hÃ­drica e promover orientaÃ§Ã£o nutricional.
    """)

# RodapÃ©
st.markdown("---")
st.markdown("<center><small>Desenvolvido para o Tech Challenge â€¢ PÃ³s-Tech FIAP â€¢ por Jess Furlan</small></center>", unsafe_allow_html=True)